# 專案說明

當我進行因子投資並擴大投資規模時，需要考慮市場衝擊。小盤股通常較不具效率，蘊藏許多 Alpha 機會，但因流動性不足，可能會導致「看得到吃不到」的情況。這意味著回測績效雖然優異，但在實際交易時，由於市場衝擊過大，難以獲利。因此，在回測時估計市場衝擊，有助於分辨哪些收益是實際可得的。

一般來說，在回測和開發策略時，通常假設以開盤價進行交易。然而，對於大多數股票而言，開盤交易量僅占整天交易量的一小部分（平均約 1%，中位數約 0.8%）。即使資金規模不大，S&P 500 成分股也可能出現流動性不足的情況。由於我僅獲取了部分股票的 Level 1 資料（美股 2024-05），僅有每個 tick 的交易資料，因此我選擇了開盤第一筆交易來獲取開盤交易量。

取得每日股票交易量的成本遠低於取得開盤交易量（需要 tick 資料）。因此，本研究的目的是希望能透過日頻資料，對「開盤交易量占整天交易量」有一個良好的估計。

這樣一來，無論在回測還是實盤交易時，都可以更好地掌握對市場的衝擊。

雖然我們並沒有 Level 2 資料，掌握「開盤交易量占整天交易量」仍可大致了解市場衝擊。例如，在回測過去資料時，如果知道當天開盤交易額，我可以計算自身交易占開盤交易額的比例：
- 1%：沒有影響
- 20%：推高 1 tick
- 50%：推高 10 tick

這些估計將有助於在實際操作中更精確地衡量市場衝擊並調整策略。

## 結論

在本研究中，我們探討了開盤交易量占整天交易量的比例（ov2tv）的影響因素，並通過多元迴歸分析得出以下結論：

### 變數的影響方向

1. **市值越大的股票，當期 ov2tv 越大**：
   市值大的股票通常更受到投資者的關注，因此在開盤時會有較大的交易量，反映出市場對新信息的快速反應。
   小市值股票不僅資金承載能力有限，其開盤交易量占整天的比例也較低，這反映出市場對這些股票的信息反應較慢。

2. **前兩天到前一天的收盤報酬絕對值越大，當期 ov2tv 越大**：
   當股票在前一天有較大的價格波動時，投資者在開盤時會更積極地進行交易，以應對這些波動。

3. **前一天到當天的收盤報酬絕對值越大，當期 ov2tv 越大**：
   當股票在前一天的波動較大時，投資者在當天開盤時會更頻繁地交易，以捕捉新的市場機會。

4. **前一天的週轉率越大，當期 ov2tv 越大**：
   前一天高週轉率表示市場對該股票的活躍度高，這種活躍度通常會延續到當天的開盤交易中。

5. **當天的週轉率越大，當期 ov2tv 越小**：
   當天高週轉率反映了整天的活躍度高，這意味著交易活動在整天內分散開來，而非集中在開盤時段。

這些結論表明，了解 ov2tv 的影響因素，有助於我們更好地掌握市場衝擊，並在實際交易中做出更精確的策略調整。掌握這些變數，可以幫助我們在回測和實盤交易時，更準確地估計市場衝擊，從而提高策略的實施效果。

## 資料說明

- `data/open_trade.xlsx`: Official Open (交易所官方開盤交易) 包含價格和交易量
- `data/db/c2c_ret.xlsx`: 收盤 (t-1) ~ (t) 的報酬（包含對股利的調整）
- `data/db/o2o_ret.xlsx`: 開盤 (t-1) ~ (t) 的報酬（包含對股利的調整）
- `data/db/close.xlsx`: 開盤價
- `data/db/open.xlsx`: 收盤價
- `data/db/volume.xlsx`: 交易量
- `data/db/shares_outstanding.xlsx`: 流通在外股數
- `data/db/univ`: 當天該股票是否包含在 S&P500成分股中 (布林值)

## 初步資料分析

### 開盤交易量 / 整天交易量

1. 對時間方向資料計算統計量 (mean, std, min, 25%, 50%, 75%, max)，共五百多檔股票的統計量
2. 上述統計量對於股票方向取中位數

```plaintext
mean      0.010214
std       0.005347
min       0.003715
25%       0.007005
50%       0.008930
75%       0.011757
max       0.026999
```

發現mean(開盤交易量 / 整天交易量) 約為1.02%，median(開盤交易量 / 整天交易量) 約為0.89%。因此，開盤交易量占整天交易量比例並不高。

### 開盤交易額 = 開盤交易量 * 開盤價格

1. 取得 S&P500 成分股的開盤交易額
2. 對時間方向計算平均值
3. 排序

```plaintext
ticker
ONL     2.694309e+04
ZIMV    4.868891e+04
EMBC    7.331892e+04
FOX     1.163689e+05
LUMN    1.182406e+05
            ...     
META    7.984950e+07
AMZN    1.097567e+08
MSFT    1.176218e+08
AAPL    1.614234e+08
NVDA    3.060501e+08
Length: 526
```

發現開盤交易量最大的股票主要是每股七巨頭。相反，交易量少的股票非常少。對於 AUM = 1,000,000 的小基金，等權重選50檔股票買進，每檔股票所需買進的金額為 1,000,000 / 50 = 50,000 = 5+e04。

對於 NVDA, AAPL, MSFT等股票，幾乎不會有市場衝擊。但對於 ONL, ZIMV, EMBC等股票，如果如回測時模擬開盤全部買進，會有極大的市場衝擊（買進金額差不多等於開盤的交易金額）。

## 研究目標

希望透過2024-05資料找到良好的估計式。

定義:
- `ov2to` = 開盤交易量 / 整天交易量
- `mktc` = 收盤價 * 流通在外股數
- `trv` = 整天交易量 / 流通在外股數
- `retabs` = 收盤到收盤的日報酬絕對值

建構回歸式：
`ov2to = f(mktc_lag, retabs_lag, trv_lag, retabs, trv)`

```plaintext
             OLS Regression Results                            
==============================================================================
Dep. Variable:                  ov2tv   R-squared:                       0.142
Model:                            OLS   Adj. R-squared:                  0.141
Method:                 Least Squares   F-statistic:                     348.8
Date:                Fri, 19 Jul 2024   Prob (F-statistic):               0.00
Time:                        18:45:05   Log-Likelihood:                 37888.
No. Observations:               10562   AIC:                        -7.576e+04
Df Residuals:                   10556   BIC:                        -7.572e+04
Df Model:                           5                                         
Covariance Type:            nonrobust                                         
==================================================================================
                     coef    std err          t      P>|t|      [0.025      0.975]
----------------------------------------------------------------------------------
const              0.0108   6.52e-05    166.380      0.000       0.011       0.011
mktc_lag           0.0015   7.34e-05     19.884      0.000       0.001       0.002
c2c_absret_lag     0.0003   7.41e-05      3.959      0.000       0.000       0.000
c2c_absret         0.0002   7.44e-05      3.264      0.001    9.71e-05       0.000
trv_lag            0.0014      0.000     10.178      0.000       0.001       0.002
trv               -0.0030      0.000    -21.752      0.000      -0.003      -0.003
==============================================================================
Omnibus:                     8643.369   Durbin-Watson:                   1.263
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           369307.497
Skew:                           3.649   Prob(JB):                         0.00
Kurtosis:                      31.034   Cond. No.                         4.53
==============================================================================
Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
```
